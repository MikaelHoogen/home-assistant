#
template:
  - sensor:
      # Avgift elnät
    - name: avgift_elnat
      unique_id: avgift_elnat
      unit_of_measurement: "Öre/kWh"
      state_class: measurement
      state: "{{ 24.25 }}"
      # Avgift energiskatt
    - name: avgift_energiskatt
      unique_id: avgift_energiskatt
      unit_of_measurement: "Öre/kWh"
      state_class: measurement
      state: "{{ 45.0 }}"
      # Elnätsabonnemang
    - name: elpris_abonnemang
      unique_id: elpris_abonnemang
      unit_of_measurement: "SEK/kWh"
      state_class: measurement
      availability: "{{ is_number(states('sensor.electricity_price_sannesholma_2181')) }}"
      state: >
        {{ ( 612.5 / state_attr('sensor.electricity_price_sannesholma_2181', 'estimated_annual_consumption') ) | round (3) }}
      # Abonnemang tibber
    - name: elpris_abonnemang_tibber
      unique_id: elpris_abonnemang_tibber
      unit_of_measurement: "SEK/kWh"
      state_class: measurement
      availability: "{{ is_number(states('sensor.electricity_price_sannesholma_2181')) }}"
      state: >
        {{ ( 39.0 * 12 / state_attr('sensor.electricity_price_sannesholma_2181', 'estimated_annual_consumption') ) | round (3) }}
      #
      ############# El totalpris ######################### TODO, hantera om någon faller bort
      # Öre
    - name: elpris_totalt
      unique_id: elpris_totalt
      unit_of_measurement: "Öre/kWh"
      state_class: measurement
      availability: "{{ is_number(states('sensor.electricity_price_sannesholma_2181')) }}"
      state: "{{ ( states('sensor.avgift_elnat') | float + states('sensor.avgift_energiskatt') | float + states('sensor.electricity_price_sannesholma_2181') | float('naan') * 100 + states('sensor.elpris_abonnemang') | float * 100 ) | round(2) }}"
      # SEK
    - name: elpris_totalt_sek
      unique_id: elpris_totalt_sek
      unit_of_measurement: "SEK/kWh"
      state_class: measurement
      availability: "{{ is_number(states('sensor.electricity_price_sannesholma_2181')) }}"
      state: "{{ ( states('sensor.avgift_elnat') | float / 100 + states('sensor.avgift_energiskatt') | float / 100 + states('sensor.electricity_price_sannesholma_2181') | float('naan') + states('sensor.elpris_abonnemang') | float ) | round(3) }}"
      # Prisnivå
    - name: elpris_price_level
      unique_id: elpris_price_level
      state: >
        {{ state_attr('sensor.electricity_price_sannesholma_2181', 'price_level') }}
#
  - binary_sensor:
      - name: "Elpris very cheap"
        unique_id: electricity_price_sannesholma_2181_very_cheap
        state: >
          {{ is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'VERY_CHEAP')
            or states('sensor.elpris') | float <= 0.1 }}
#
      - name: "Elpris cheap"
        unique_id: electricity_price_sannesholma_2181_cheap
        state: >
          {{ is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'VERY_CHEAP')
            or is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'CHEAP')
            or states('sensor.elpris') | float <= 0.2 }}
#
      - name: "Elpris normal"
        unique_id: electricity_price_sannesholma_2181_normal
        state: >
          {{ is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'NORMAL')
            or states('sensor.elpris') | float <= 0.2 }}
#
      - name: "Elpris expensive"
        unique_id: electricity_price_sannesholma_2181_expensive
        state: >
          {{ is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'EXPENSIVE') }}
#
      - name: "Elpris very expensive"
        unique_id: electricity_price_sannesholma_2181_very_expensive
        state: >
          {{ is_state_attr('sensor.electricity_price_sannesholma_2181', 'price_level', 'VERY_EXPENSIVE') }}
        # Maxpris
      - name: electricity_price_sannesholma_2181_max
        unique_id: electricity_price_sannesholma_2181_max
        delay_on:
          minutes: 1
        state: >-
          {{ states('sensor.electricity_price_sannesholma_2181') | float(0.0) == state_attr('sensor.electricity_price_sannesholma_2181', 'max_price') | float(0.1) }}
#          {{ states('sensor.elpris') | float(0.0) == state_attr('sensor.elpris', 'max') | float(0.1) }}
        # Max 3
      - name: electricity_price_sannesholma_2181_max_3
        unique_id: electricity_price_sannesholma_2181_max_3
        delay_on:
          seconds: 5
        state: >-
          {{ ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[0] )
            or ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[1] )
            or ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[2] ) }}
        # Max 4
      - name: electricity_price_sannesholma_2181_max_4
        unique_id: electricity_price_sannesholma_2181_max_4
        delay_on:
          seconds: 5
        state: >-
          {{ ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[0] )
            or ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[1] )
            or ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[2] )
            or ( states('sensor.elpris') | float(0.0) == ( state_attr('sensor.elpris', 'today') | sort(reverse=true))[3] ) }}
        # Below mean sensor.electricity_price_sannesholma_2181
      - name: electricity_price_sannesholma_2181_below_avg_price
        unique_id: electricity_price_sannesholma_2181_below_avg_price
        availability: "{{ is_number(states('sensor.electricity_price_sannesholma_2181')) }}"
        delay_on:
          seconds: 5
        state: >-
          {{ states('sensor.electricity_price_sannesholma_2181') | float('naan') <= state_attr('sensor.electricity_price_sannesholma_2181', 'avg_price') }}
#
  - sensor:
      # Elförbrukning prognos
      # Estimated annual consumption
      - name: electricity_estimated_annual_consumption
        unique_id: electricity_estimated_annual_consumption
        unit_of_measurement: "kWh"
        state_class: measurement
        device_class: energy
        state: >
          {{ state_attr('sensor.electricity_price_sannesholma_2181', 'estimated_annual_consumption') }}
#
binary_sensor:
  - platform: trend
    sensors:
      electricity_consumption_trend_higher:
        entity_id: sensor.electricity_price_sannesholma_2181
        attribute: estimated_annual_consumption
      electricity_consumption_trend_lower:
        entity_id: sensor.electricity_price_sannesholma_2181
        attribute: estimated_annual_consumption
        invert: true
#
#
sensor:
  - platform: average
    name: elpris_totalt_medel
    unique_id: elpris_totalt_medel
    start: "{{ now().replace(day=1, hour=0, minute=0, second=0, microsecond=0) }}"
    end: "{{ now() }}"
    entities:
      - sensor.elpris_totalt_sek
    #
  - platform: average
    name: elpris_tibber_medel
    unique_id: elpris_tibber_medel
    start: "{{ now().replace(day=1, hour=0, minute=0, second=0, microsecond=0) }}"
    end: "{{ now() }}"
    entities:
      - sensor.electricity_price_sannesholma_2181
    #
  - platform: template
    sensors:
      ############# El klockslag #########################
      elpris_idag_00:
        value_template: "{{ state_attr('sensor.elpris', 'today')[0] }}"
        unit_of_measurement: "SEK/kWh"
        attribute_templates:
          timme: "00:00 - 01:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[0] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[0] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[0] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[1] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[2] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_01:
        value_template: "{{ state_attr('sensor.elpris', 'today')[1] }}"
        unit_of_measurement: "SEK/kWh"
        attribute_templates:
          timme: "01:00 - 02:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[1] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[1] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[1] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[2] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[3] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_02:
        value_template: "{{ state_attr('sensor.elpris', 'today')[2] }}"
        attribute_templates:
          timme: "02:00 - 03:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[2] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[2] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[2] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[3] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[4] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_03:
        value_template: "{{ state_attr('sensor.elpris', 'today')[3] }}"
        attribute_templates:
          timme: "03:00 - 04:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[3] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[3] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[3] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[4] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[5] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_04:
        value_template: "{{ state_attr('sensor.elpris', 'today')[4] }}"
        attribute_templates:
          timme: "04:00 - 05:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[4] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[4] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[4] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[5] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[6] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_05:
        value_template: "{{ state_attr('sensor.elpris', 'today')[5] }}"
        attribute_templates:
          timme: "05:00 - 06:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[5] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[5] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[5] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[6] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[7] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_06:
        value_template: "{{ state_attr('sensor.elpris', 'today')[6] }}"
        attribute_templates:
          timme: "06:00 - 07:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[6] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[6] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% else %}
            -
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[6] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[7] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[8] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_07:
        value_template: "{{ state_attr('sensor.elpris', 'today')[7] }}"
        attribute_templates:
          timme: "07:00 - 08:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[7] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[7] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[7] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[8] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[9] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_08:
        value_template: "{{ state_attr('sensor.elpris', 'today')[8] }}"
        attribute_templates:
          timme: "08:00 - 09:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[8] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[8] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[8] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[9] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[10] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_09:
        value_template: "{{ state_attr('sensor.elpris', 'today')[9] }}"
        attribute_templates:
          timme: "09:00 - 10:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[9] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[9] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[9] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[10] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[11] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_10:
        value_template: "{{ state_attr('sensor.elpris', 'today')[10] }}"
        attribute_templates:
          timme: "10:00 - 11:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[10] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[10] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[10] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[11] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[12] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_11:
        value_template: "{{ state_attr('sensor.elpris', 'today')[11] }}"
        attribute_templates:
          timme: "11:00 - 12:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[11] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[11] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[11] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[12] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[13] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_12:
        value_template: "{{ state_attr('sensor.elpris', 'today')[12] }}"
        attribute_templates:
          timme: "12:00 - 13:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[12] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[12] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[12] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[13] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[14] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_13:
        value_template: "{{ state_attr('sensor.elpris', 'today')[13] }}"
        attribute_templates:
          timme: "13:00 - 14:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[13] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[13] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[13] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[14] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[15] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_14:
        value_template: "{{ state_attr('sensor.elpris', 'today')[14] }}"
        attribute_templates:
          timme: "14:00 - 15:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[14] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[14] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[14] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[15] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[16] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_15:
        value_template: "{{ state_attr('sensor.elpris', 'today')[15] }}"
        attribute_templates:
          timme: "15:00 - 16:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[15] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[15] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[15] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[16] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[17] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_16:
        value_template: "{{ state_attr('sensor.elpris', 'today')[16] }}"
        attribute_templates:
          timme: "16:00 - 17:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[16] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[16] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[16] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[17] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[18] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_17:
        value_template: "{{ state_attr('sensor.elpris', 'today')[17] }}"
        attribute_templates:
          timme: "17:00 - 18:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[17] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[17] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[17] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[18] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[19] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_18:
        value_template: "{{ state_attr('sensor.elpris', 'today')[18] }}"
        attribute_templates:
          timme: "18:00 - 19:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[18] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[18] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[18] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[19] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[20] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_19:
        value_template: "{{ state_attr('sensor.elpris', 'today')[19] }}"
        attribute_templates:
          timme: "19:00 - 20:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[19] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[19] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[19] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[20] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[21] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_20:
        value_template: "{{ state_attr('sensor.elpris', 'today')[20] }}"
        attribute_templates:
          timme: "20:00 - 21:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[20] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[20] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[20] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[21] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[22] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_21:
        value_template: "{{ state_attr('sensor.elpris', 'today')[21] }}"
        attribute_templates:
          timme: "21:00 - 23:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[21] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[21] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if state_attr('sensor.elpris', 'today')[21] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[22] <= state_attr('sensor.elpris', 'average')
                and state_attr('sensor.elpris', 'today')[23] <= state_attr('sensor.elpris', 'average') %}
            Ok
            {% else %}
            Nej
            {% endif %}
      #
      elpris_idag_22:
        value_template: "{{ state_attr('sensor.elpris', 'today')[22] }}"
        attribute_templates:
          timme: "22:00 - 23:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[22] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[22] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'today')[22] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'today')[23] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[0] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_idag_23:
        value_template: "{{ state_attr('sensor.elpris', 'today')[23] }}"
        attribute_templates:
          timme: "23:00 - 00:00"
          kommentar: >
            {% if state_attr('sensor.elpris', 'today')[23] == state_attr('sensor.elpris', 'max') %}
            Högsta pris
            {% elif state_attr('sensor.elpris', 'today')[23] < state_attr('sensor.elpris', 'average') %}
            Under medel
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'today')[23] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[0] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[1] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_00:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[0] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "00:00 - 01:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[0] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[0] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[0] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_01:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[1] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[1] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "01:00 - 02:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[1] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[1] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[2] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[3] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_02:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[2] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[2] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "02:00 - 03:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[2] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[2] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[2] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[3] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[4] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_03:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[3] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[3] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "03:00 - 04:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[3] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[3] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[3] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[4] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[5] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_04:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[4] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[4] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "04:00 - 05:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[4] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[4] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[4] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[5] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[6] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_05:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[5] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[5] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "05:00 - 06:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[5] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[5] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[5] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[6] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[7] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_06:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[6] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[6] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "06:00 - 07:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[6] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[6] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[6] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[7] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[8] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_07:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[7] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[7] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "07:00 - 08:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[7] == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif state_attr('sensor.elpris', 'tomorrow')[7] < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[7] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[8] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[9] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[7] + state_attr('sensor.elpris', 'tomorrow')[8] + state_attr('sensor.elpris', 'tomorrow')[9] ) / 3 }}
      #
      elpris_imorgon_08:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[8] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[8] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "08:00 - 09:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[8] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {% if state_attr('sensor.elpris', 'tomorrow')[8] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[8 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[8 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[8] + state_attr('sensor.elpris', 'tomorrow')[8 + 1] + state_attr('sensor.elpris', 'tomorrow')[8 + 2] ) / 3 }}
      #
      elpris_imorgon_09:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[9] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[9] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "09:00 - 10:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[9] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[9] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[9 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[9 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[9] + state_attr('sensor.elpris', 'tomorrow')[9 + 1] + state_attr('sensor.elpris', 'tomorrow')[9 + 2] ) / 3 }}
      #
      elpris_imorgon_10:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[10] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[10] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "10:00 - 11:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[10] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[10] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[10 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[10 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[10] + state_attr('sensor.elpris', 'tomorrow')[10 + 1] + state_attr('sensor.elpris', 'tomorrow')[10 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_11:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[11] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[11] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "11:00 - 12:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[11] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[11] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[11 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[11 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[11] + state_attr('sensor.elpris', 'tomorrow')[11 + 1] + state_attr('sensor.elpris', 'tomorrow')[11 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_12:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[12] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[12] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "12:00 - 13:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[12] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[12] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[12 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[12 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[12] + state_attr('sensor.elpris', 'tomorrow')[12 + 1] + state_attr('sensor.elpris', 'tomorrow')[12 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_13:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[13] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[13] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "13:00 - 14:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[13] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[13] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[13 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[13 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[13] + state_attr('sensor.elpris', 'tomorrow')[13 + 1] + state_attr('sensor.elpris', 'tomorrow')[13 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_14:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[14] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[14] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "14:00 - 15:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[14] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[14] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[14 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[14 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[14] + state_attr('sensor.elpris', 'tomorrow')[14 + 1] + state_attr('sensor.elpris', 'tomorrow')[14 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_15:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[15] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[15] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "15:00 - 16:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[15] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[15] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[15 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[15 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[15] + state_attr('sensor.elpris', 'tomorrow')[15 + 1] + state_attr('sensor.elpris', 'tomorrow')[15 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_16:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[16] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[16] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "16:00 - 17:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[16] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[16] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[16 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[16 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[16] + state_attr('sensor.elpris', 'tomorrow')[16 + 1] + state_attr('sensor.elpris', 'tomorrow')[16 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_17:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[17] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[17] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "17:00 - 18:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[17] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[17] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[17 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[17 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          medel_3h: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
              {{ ( state_attr('sensor.elpris', 'tomorrow')[17] + state_attr('sensor.elpris', 'tomorrow')[17 + 1] + state_attr('sensor.elpris', 'tomorrow')[17 + 2] ) / 3 | round(2) }}
            {% else %}
            Pris saknas
            {% endif %}
      #
      elpris_imorgon_18:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[18] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[18] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "18:00 - 19:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[18] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[19] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[18 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[18 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[18] + state_attr('sensor.elpris', 'tomorrow')[18 + 1] + state_attr('sensor.elpris', 'tomorrow')[18 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_19:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[19] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[19] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "19:00 - 20:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[19] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[19] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[19 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[19 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[19] + state_attr('sensor.elpris', 'tomorrow')[19 + 1] + state_attr('sensor.elpris', 'tomorrow')[19 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_20:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[20] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[20] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "20:00 - 21:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[20] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[20] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[20 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[20 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[20] + state_attr('sensor.elpris', 'tomorrow')[20 + 1] + state_attr('sensor.elpris', 'tomorrow')[20 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_21:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[21] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[21] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "21:00 - 22:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[21] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[21] %}
              {% if price <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[21 + 1] <= state_attr('sensor.elpris', 'average')
                  and state_attr('sensor.elpris', 'tomorrow')[21 + 2] <= state_attr('sensor.elpris', 'average') %}
              Ok
              {% else %}
              Nej
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
      #          medel_3h: >
      #            {{ ( state_attr('sensor.elpris', 'tomorrow')[21] + state_attr('sensor.elpris', 'tomorrow')[21 + 1] + state_attr('sensor.elpris', 'tomorrow')[21 + 2] ) / 3 | round(2) }}
      #
      elpris_imorgon_22:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[22] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[22] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "22:00 - 23:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[22] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            -
          medel_3h: >
            -
      #
      elpris_imorgon_23:
        value_template: >
          {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[23] != None %}
            {{ state_attr('sensor.elpris', 'tomorrow')[23] }}
          {% else %}
          -
          {% endif %}
        attribute_templates:
          timme: "23:00 - 00:00"
          kommentar: >
            {% if is_state_attr('sensor.elpris', 'tomorrow_valid', True) and state_attr('sensor.elpris', 'tomorrow')[0] != None %}
            {% set price = state_attr('sensor.elpris', 'tomorrow')[23] %}
              {% if price == state_attr('sensor.elpris', 'max') %}
              Högsta pris
              {% elif price < state_attr('sensor.elpris', 'average') %}
              Under medel
              {% endif %}
            {% else %}
            Pris saknas
            {% endif %}
          disk: >
            -
          medel_3h: >
            -
      #
